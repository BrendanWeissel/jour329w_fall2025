<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>CNS Tag Browser</title>
    <link rel="stylesheet" href="style.css">
    <style>
        body { background: #181818; color: #fff; font-family: sans-serif; margin: 0; padding: 0; }
        .container { max-width: 900px; margin: 2em auto; background: #222; border-radius: 1em; padding: 2em; box-shadow: 0 2px 16px #0008; }
        h1 { text-align: center; font-size: 2.5em; margin-bottom: 0.2em; }
        .catchline { text-align: center; font-size: 1.5em; margin-top: 2em; color: #ffb347; }
        .search-row { display: flex; justify-content: center; align-items: center; margin-bottom: 1.5em; gap: 1em; }
        #search { width: 60%; font-size: 1.2em; padding: 0.5em 1em; border-radius: 1em; border: none; }
        #categoryDropdown { font-size: 1.1em; padding: 0.4em 1em; border-radius: 1em; border: none; background: #222; color: #ffb347; }
        .tags-list { margin: 0; padding: 0; list-style: none; display: flex; flex-wrap: wrap; justify-content: center; }
        .tags-list li { margin: 0.5em 0.7em; }
        .tag-pill { display: inline-block; background: #ffb347; color: #222; font-weight: bold; border-radius: 2em; padding: 0.5em 1.2em; font-size: 1.2em; text-decoration: none; transition: background 0.2s; }
        .tag-pill:hover { background: #ffd580; color: #181818; }
    </style>
</head>
<body>
    <div class="container">
        <h1>CNS Tag Browser</h1>
        <div class="search-row">
            <input type="text" id="search" placeholder="Search tags..." />
            <select id="categoryDropdown">
                <option value="all">All Categories</option>
            </select>
        </div>
        <ul id="tagsList" class="tags-list"></ul>
        <div class="catchline">Explore Maryland news, topics, and trends with Capital News Service</div>
    </div>
    <script>
    const categoryDefs = [
        { name: 'Politics', keywords: ['politic', 'election', 'senate', 'congress', 'governor', 'legislature', 'law', 'bill', 'campaign', 'vote'] },
        { name: 'Cities', keywords: ['baltimore', 'annapolis', 'rockville', 'city', 'town', 'village'] },
        { name: 'Counties', keywords: ['county', 'montgomery', 'prince george', 'howard', 'anne arundel', 'frederick', 'carroll', 'harford', 'charles', 'calvert'] },
        { name: 'Education', keywords: ['school', 'college', 'university', 'education', 'student', 'teacher', 'classroom'] },
        { name: 'Health', keywords: ['health', 'hospital', 'doctor', 'nurse', 'covid', 'vaccine', 'mental', 'medical'] },
        { name: 'Crime & Justice', keywords: ['crime', 'police', 'court', 'judge', 'prison', 'jail', 'justice', 'law enforcement'] },
        { name: 'Environment', keywords: ['environment', 'climate', 'water', 'bay', 'river', 'forest', 'wildlife', 'nature'] },
        { name: 'Transportation', keywords: ['transport', 'bus', 'train', 'metro', 'road', 'highway', 'traffic', 'transit'] },
        { name: 'Business', keywords: ['business', 'company', 'industry', 'commerce', 'startup', 'market', 'trade'] },
        { name: 'Sports', keywords: ['sport', 'team', 'game', 'athlete', 'coach', 'league', 'tournament'] },
        { name: 'Arts & Culture', keywords: ['art', 'music', 'theater', 'film', 'museum', 'culture', 'festival'] },
        { name: 'Government', keywords: ['government', 'agency', 'public', 'official', 'mayor', 'council'] },
        { name: 'People', keywords: ['person', 'people', 'profile', 'biography', 'student', 'teacher'] },
        { name: 'Science & Tech', keywords: ['science', 'tech', 'technology', 'research', 'innovation', 'data', 'computer'] },
        { name: 'Housing', keywords: ['housing', 'home', 'apartment', 'real estate', 'rent', 'tenant'] },
        { name: 'Food', keywords: ['food', 'restaurant', 'bar', 'cafe', 'grocery', 'market'] },
        { name: 'Religion', keywords: ['religion', 'church', 'faith', 'mosque', 'temple', 'synagogue'] },
        { name: 'Military', keywords: ['military', 'army', 'navy', 'air force', 'marine', 'veteran'] },
        { name: 'Immigration', keywords: ['immigration', 'immigrant', 'refugee', 'asylum'] },
        { name: 'Other', keywords: [] }
    ];
    let allTags = [];
    let categorized = {};
    function formatTagName(name) {
        let displayName = name;
        if (displayName.startsWith('#')) displayName = displayName.slice(1).trim();
        displayName = displayName.replace(/([a-z])([A-Z])/g, '$1 $2');
        displayName = displayName.replace(/\b\w/g, c => c.toUpperCase());
        return displayName;
    }
    function categorizeTags(tags) {
        categorized = {};
        categoryDefs.forEach(cat => categorized[cat.name] = []);
        tags.forEach(tag => {
            let found = false;
            for (const cat of categoryDefs) {
                if (cat.keywords.some(kw => tag.name.toLowerCase().includes(kw))) {
                    categorized[cat.name].push(tag);
                    found = true;
                    break;
                }
            }
            if (!found) categorized['Other'].push(tag);
        });
    }
    function renderTagsList(tags) {
        const ul = document.getElementById('tagsList');
        ul.innerHTML = '';
        tags.forEach(tag => {
            const li = document.createElement('li');
            const a = document.createElement('a');
            a.href = tag.link;
            a.target = '_blank';
            a.className = 'tag-pill';
            a.textContent = formatTagName(tag.name);
            a.rel = 'noopener noreferrer';
            li.appendChild(a);
            ul.appendChild(li);
        });
    }
    function updateCategoryDropdown() {
        const dropdown = document.getElementById('categoryDropdown');
        dropdown.innerHTML = '<option value="all">All Categories</option>' + categoryDefs.map(c => `<option value="${c.name}">${c.name}</option>`).join('');
    }
    function filterAndRender() {
        const search = document.getElementById('search').value.toLowerCase();
        const category = document.getElementById('categoryDropdown').value;
        let tags = allTags.filter(tag => tag.name && tag.count !== 0 && formatTagName(tag.name).toLowerCase().includes(search));
        if (category !== 'all') {
            tags = categorized[category] || [];
            tags = tags.filter(tag => formatTagName(tag.name).toLowerCase().includes(search));
        }
        tags.sort((a, b) => b.count - a.count);
        renderTagsList(tags.slice(0, 20));
    }
    document.getElementById('search').addEventListener('input', filterAndRender);
    document.getElementById('categoryDropdown').addEventListener('change', filterAndRender);
    fetch('/data/tags.json')
        .then(res => res.json())
        .then(data => {
            allTags = data;
            categorizeTags(allTags);
            updateCategoryDropdown();
            filterAndRender();
        })
        .catch(err => {
            document.getElementById('tagsList').innerHTML = '<li style="color:red;">Could not load tags.json: ' + err.message + '</li>';
        });
    </script>
</body>
</html>
